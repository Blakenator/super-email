---
description: 'Project-wide coding standards and conventions for the email client project'
alwaysApply: true
---

# Email Client Project Standards

## Package Management

- Always use `pnpm` instead of `yarn`, `npm`, or `npx`
- Use workspace protocol (`workspace:^`) for internal package dependencies
- Run commands from the root when possible, using `pnpm run --filter` for workspace-specific commands

## Component Organization

- Extract components to `frontend/src/core/components/` when:
  - Used in more than one place, OR
  - Used so frequently that consistency is important (e.g., Button bootstrap wrapper, filters, EmailChipInput)
- Use `.wrappers.ts` files whenever styled-components are needed (following the pattern of Button.wrappers.ts, EmailChipInput.wrappers.ts)
- Prefer using existing core components over bespoke new components where possible

## AWS Dependencies & Local Development

- This project must run both locally and in AWS
- Any AWS service dependency MUST have a local alternative:
  - **S3**: Use local file system (`data/attachments/`) in development, S3 in production
  - **Secrets Manager**: Use local JSON file (`data/secrets.json`) in development, AWS Secrets Manager in production
- Check `config.isProduction` to determine which implementation to use
- AWS SDK clients should be conditionally initialized (only in production) to avoid local dependency issues

## GraphQL Schema Documentation

- **All GraphQL schema elements MUST have documentation comments** using triple-quoted strings (`"""..."""`)
- Required documentation for:
  - Types and input types: describe the entity's purpose
  - Queries and mutations: describe what the operation does
  - Fields: describe the field's meaning and any constraints
  - Scalars: describe the format and validation rules
  - Enums: describe each enum value's meaning
- Example:
  ```graphql
  """
  A tag that can be applied to emails for organization.
  Tags are user-specific and can have custom colors.
  """
  type Tag {
    """
    Unique identifier for this tag
    """
    id: String!
    """
    Display name shown in the UI
    """
    name: String!
    """
    Hex color code (e.g., "#ff0000")
    """
    color: String!
  }
  ```

## Testing Requirements

- **All new GraphQL queries/mutations MUST have corresponding tests**
- **All new helper functions in `backend/helpers/` MUST have unit tests**
- Test file naming conventions:
  - Unit tests: `*.unit.test.ts` - for pure functions, helpers, utilities
  - Integration tests: `*.integration.test.ts` - for GraphQL operations, DB interactions
- Test scripts:
  - `pnpm test` - run all tests
  - `pnpm test:unit` - run only unit tests
  - `pnpm test:integration` - run only integration tests
- Use the shared test server in `test/integration/server-setup.ts` for integration tests
- Integration tests share a single server instance across all test files

## Code Style

- Use TypeScript strict mode
- Follow existing patterns for GraphQL queries/mutations (use codegen from `common/schema.graphql`)
- Use Sequelize models in `backend/db/models/` for database operations
- **Sequelize Circular Dependencies**: Use dual imports to avoid `emitDecoratorMetadata` issues:
  ```typescript
  import { Model } from './model.js';                    // For decorators
  import type { Model as ModelType } from './model.js';  // For types
  @BelongsTo(() => Model, { onDelete: 'CASCADE' })
  declare relation?: ModelType;  // Use type alias
  ```
- Centralize configuration in `backend/config/env.ts`
- Use the logger from `backend/helpers/logger.ts` instead of console.log

## File Structure

- Backend: `backend/mutations/` and `backend/queries/` for GraphQL resolvers
- Frontend: `frontend/src/pages/` for route components, `frontend/src/components/` for page-specific components
- Shared types: Use GraphQL schema in `common/schema.graphql` and generate types
- Tests: `backend/test/helpers/` for unit tests, `backend/test/integration/` for integration tests

## Environment Configuration

- All environment variables should be accessed through `backend/config/env.ts`
- Never hardcode AWS credentials or secrets
- Use `config.isProduction` and `config.isDevelopment` flags for environment checks
