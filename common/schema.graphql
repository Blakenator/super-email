scalar Date
scalar JSON

interface BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
}

# ============ User & Authentication ============

type User implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  email: String!
  firstName: String!
  lastName: String!
  emailAccounts: [EmailAccount!]!
  smtpProfiles: [SmtpProfile!]!
  authenticationMethods: [AuthenticationMethod!]!
}

enum AuthProvider {
  EMAIL_PASSWORD
  GOOGLE
  GITHUB
  APPLE
  MICROSOFT
}

type AuthenticationMethod implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  userId: String!
  provider: AuthProvider!
  providerUserId: String!
  email: String!
  displayName: String
  lastUsedAt: Date
}


# ============ Email Accounts (IMAP/POP) ============

enum EmailAccountType {
  IMAP
  POP3
}

type EmailAccount implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  userId: String!
  name: String!
  email: String!
  host: String!
  port: Int!
  accountType: EmailAccountType!
  useSsl: Boolean!
  lastSyncedAt: Date
  isSyncing: Boolean!
  syncProgress: Int
  syncStatus: String
  defaultSmtpProfileId: String
  defaultSmtpProfile: SmtpProfile
  providerId: String
}

input CreateEmailAccountInput {
  name: String!
  email: String!
  host: String!
  port: Int!
  username: String!
  password: String!
  accountType: EmailAccountType!
  useSsl: Boolean!
  defaultSmtpProfileId: String
  providerId: String
}

input UpdateEmailAccountInput {
  id: String!
  name: String
  host: String
  port: Int
  username: String
  password: String
  useSsl: Boolean
  defaultSmtpProfileId: String
  providerId: String
}

# ============ SMTP Profiles ============

type SmtpProfile implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  userId: String!
  name: String!
  email: String!
  alias: String
  host: String!
  port: Int!
  useSsl: Boolean!
  isDefault: Boolean!
  providerId: String
}

input CreateSmtpProfileInput {
  name: String!
  email: String!
  alias: String
  host: String!
  port: Int!
  username: String!
  password: String!
  useSsl: Boolean!
  isDefault: Boolean
  providerId: String
}

input UpdateSmtpProfileInput {
  id: String!
  name: String
  alias: String
  host: String
  port: Int
  username: String
  password: String
  useSsl: Boolean
  isDefault: Boolean
  providerId: String
}

# ============ Contacts ============

type ContactEmail implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  contactId: String!
  email: String!
  isPrimary: Boolean!
  label: String
}

type Contact implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  userId: String!
  email: String
  emails: [ContactEmail!]!
  name: String
  firstName: String
  lastName: String
  company: String
  phone: String
  notes: String
  isAutoCreated: Boolean!
}

input ContactEmailInput {
  email: String!
  isPrimary: Boolean
  label: String
}

input CreateContactInput {
  emails: [ContactEmailInput!]!
  name: String
  firstName: String
  lastName: String
  company: String
  phone: String
  notes: String
}

input UpdateContactInput {
  id: String!
  emails: [ContactEmailInput!]
  name: String
  firstName: String
  lastName: String
  company: String
  phone: String
  notes: String
}

input AddEmailToContactInput {
  contactId: String!
  email: String!
  isPrimary: Boolean
  label: String
}

# ============ Emails ============

enum EmailFolder {
  INBOX
  SENT
  DRAFTS
  TRASH
  SPAM
  ARCHIVE
}

type Email implements BaseEntityProps {
  id: String!
  createdAt: Date
  updatedAt: Date
  emailAccountId: String!
  emailAccount: EmailAccount
  smtpProfileId: String
  smtpProfile: SmtpProfile
  messageId: String!
  folder: EmailFolder!
  fromAddress: String!
  fromName: String
  toAddresses: [String!]!
  ccAddresses: [String!]
  bccAddresses: [String!]
  subject: String!
  textBody: String
  htmlBody: String
  receivedAt: Date!
  isRead: Boolean!
  isStarred: Boolean!
  isDraft: Boolean!
  inReplyTo: String
  references: [String!]
  threadId: String
  threadCount: Int
  headers: JSON
  isUnsubscribed: Boolean!
  unsubscribeUrl: String
  unsubscribeEmail: String
}

input GetEmailsInput {
  emailAccountId: String
  folder: EmailFolder
  limit: Int
  offset: Int
  isRead: Boolean
  isStarred: Boolean
  searchQuery: String
}

input GetEmailInput {
  id: String!
}

input ComposeEmailInput {
  emailAccountId: String!
  smtpProfileId: String!
  toAddresses: [String!]!
  ccAddresses: [String!]
  bccAddresses: [String!]
  subject: String!
  textBody: String
  htmlBody: String
  inReplyTo: String
  draftId: String
}

input SaveDraftInput {
  id: String
  emailAccountId: String!
  smtpProfileId: String
  toAddresses: [String!]
  ccAddresses: [String!]
  bccAddresses: [String!]
  subject: String
  textBody: String
  htmlBody: String
  inReplyTo: String
}

input BulkUpdateEmailsInput {
  ids: [String!]!
  isRead: Boolean
  isStarred: Boolean
  folder: EmailFolder
}

input ForwardEmailInput {
  emailId: String!
  emailAccountId: String!
  smtpProfileId: String!
  toAddresses: [String!]!
  ccAddresses: [String!]
  bccAddresses: [String!]
  additionalText: String
}

input SyncEmailAccountInput {
  emailAccountId: String!
}

input UnsubscribeInput {
  emailId: String!
}

# ============ Test Connection ============

type TestConnectionResult {
  success: Boolean!
  message: String!
}

input TestEmailAccountConnectionInput {
  host: String!
  port: Int!
  username: String!
  password: String!
  accountType: EmailAccountType!
  useSsl: Boolean!
}

input TestSmtpConnectionInput {
  host: String!
  port: Int!
  username: String!
  password: String!
  useSsl: Boolean!
}

# ============ Queries ============

type Query {
  # Auth
  fetchProfile: User
  getAuthenticationMethods: [AuthenticationMethod!]!

  # Email Accounts
  getEmailAccounts: [EmailAccount!]!
  getEmailAccount(id: String!): EmailAccount

  # SMTP Profiles
  getSmtpProfiles: [SmtpProfile!]!
  getSmtpProfile(id: String!): SmtpProfile

  # Emails
  getEmails(input: GetEmailsInput!): [Email!]!
  getEmail(input: GetEmailInput!): Email
  getEmailCount(input: GetEmailsInput!): Int!
  getEmailsByThread(threadId: String!): [Email!]!

  # Contacts
  getContacts: [Contact!]!
  getContact(id: String!): Contact
  searchContacts(query: String!): [Contact!]!
}

# ============ Mutations ============

type Mutation {
  # Auth
  deleteAuthenticationMethod(id: String!): Boolean!

  # Email Accounts
  createEmailAccount(input: CreateEmailAccountInput!): EmailAccount!
  updateEmailAccount(input: UpdateEmailAccountInput!): EmailAccount!
  deleteEmailAccount(id: String!): Boolean!
  syncEmailAccount(input: SyncEmailAccountInput!): Boolean!

  # SMTP Profiles
  createSmtpProfile(input: CreateSmtpProfileInput!): SmtpProfile!
  updateSmtpProfile(input: UpdateSmtpProfileInput!): SmtpProfile!
  deleteSmtpProfile(id: String!): Boolean!

  # Test Connections
  testEmailAccountConnection(input: TestEmailAccountConnectionInput!): TestConnectionResult!
  testSmtpConnection(input: TestSmtpConnectionInput!): TestConnectionResult!

  # Emails
  sendEmail(input: ComposeEmailInput!): Email!
  saveDraft(input: SaveDraftInput!): Email!
  bulkUpdateEmails(input: BulkUpdateEmailsInput!): [Email!]!
  bulkDeleteEmails(ids: [String!]!): Int!
  forwardEmail(input: ForwardEmailInput!): Email!
  unsubscribe(input: UnsubscribeInput!): Email!

  # Contacts
  createContact(input: CreateContactInput!): Contact!
  updateContact(input: UpdateContactInput!): Contact!
  deleteContact(id: String!): Boolean!
  createContactFromEmail(emailId: String!): Contact!
  addEmailToContact(input: AddEmailToContactInput!): Contact!

  # Sync
  syncAllAccounts: Boolean!

  # Inbox Zero
  nukeOldEmails(input: NukeOldEmailsInput!): Int!
}

input NukeOldEmailsInput {
  olderThan: Date!
}

# ============ Subscriptions ============

type Subscription {
  emailCreated: Email!
  emailUpdated: Email!
}
