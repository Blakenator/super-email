"""
Custom scalar for date/time values. Serializes to ISO 8601 string format.
"""
scalar Date

"""
Custom scalar for arbitrary JSON data. Used for complex nested structures like email headers.
"""
scalar JSON

"""
Common fields shared by all database entities.
"""
interface BaseEntityProps {
  """Unique identifier for the entity (UUID format)"""
  id: String!
  """Timestamp when the entity was created"""
  createdAt: Date
  """Timestamp when the entity was last updated"""
  updatedAt: Date
}

# ============ User & Authentication ============

"""
User's preferred color scheme for the application interface.
"""
enum ThemePreference {
  """Light color scheme"""
  LIGHT
  """Dark color scheme"""
  DARK
  """Follow system/browser preference"""
  AUTO
}

"""
Level of detail shown in email notification previews.
"""
enum NotificationDetailLevel {
  """Show only sender and subject"""
  MINIMAL
  """Show sender, subject, and message preview"""
  FULL
}

"""
A registered user of the email client application.
Contains user profile information, preferences, and related entities.
"""
type User implements BaseEntityProps {
  """Unique identifier for the user (UUID format)"""
  id: String!
  """Timestamp when the user account was created"""
  createdAt: Date
  """Timestamp when the user account was last updated"""
  updatedAt: Date
  """User's primary email address (used for login)"""
  email: String!
  """User's first name"""
  firstName: String!
  """User's last name"""
  lastName: String!
  """User's preferred color scheme (LIGHT, DARK, or AUTO)"""
  themePreference: ThemePreference!
  """Whether the navigation sidebar is collapsed"""
  navbarCollapsed: Boolean!
  """Level of detail in notification previews"""
  notificationDetailLevel: NotificationDetailLevel!
  """Whether to use compact/dense inbox display mode"""
  inboxDensity: Boolean!
  """Whether to group emails by date in the inbox view"""
  inboxGroupByDate: Boolean!
  """List of email accounts configured for this user (IMAP/POP3)"""
  emailAccounts: [EmailAccount!]!
  """List of SMTP profiles configured for sending emails"""
  smtpProfiles: [SmtpProfile!]!
  """List of authentication methods linked to this account (OAuth, email/password)"""
  authenticationMethods: [AuthenticationMethod!]!
}

"""
Input for updating user preferences. All fields are optional - only provided fields will be updated.
"""
input UpdateUserPreferencesInput {
  """New theme preference"""
  themePreference: ThemePreference
  """Whether to collapse the navigation sidebar"""
  navbarCollapsed: Boolean
  """New notification detail level"""
  notificationDetailLevel: NotificationDetailLevel
  """Whether to use compact inbox display"""
  inboxDensity: Boolean
  """Whether to group emails by date"""
  inboxGroupByDate: Boolean
}

"""
Supported authentication providers for user login.
"""
enum AuthProvider {
  """Traditional email and password login"""
  EMAIL_PASSWORD
  """Google OAuth login"""
  GOOGLE
  """GitHub OAuth login"""
  GITHUB
  """Apple Sign-In"""
  APPLE
  """Microsoft/Azure AD login"""
  MICROSOFT
}

"""
Represents a linked authentication method for a user account.
Users can have multiple authentication methods (e.g., Google OAuth + email/password).
"""
type AuthenticationMethod implements BaseEntityProps {
  """Unique identifier for this authentication method"""
  id: String!
  """Timestamp when this auth method was linked"""
  createdAt: Date
  """Timestamp when this auth method was last updated"""
  updatedAt: Date
  """ID of the user this auth method belongs to"""
  userId: String!
  """The authentication provider (GOOGLE, EMAIL_PASSWORD, etc.)"""
  provider: AuthProvider!
  """Unique identifier from the provider (e.g., Google user ID)"""
  providerUserId: String!
  """Email address associated with this auth provider"""
  email: String!
  """Display name from the provider (e.g., "john@gmail.com (Google)")"""
  displayName: String
  """Timestamp when this auth method was last used for login"""
  lastUsedAt: Date
}


# ============ Email Accounts (IMAP/POP) ============

"""
Type of email receiving protocol.
"""
enum EmailAccountType {
  """IMAP protocol - supports folder sync and IDLE for real-time updates"""
  IMAP
  """POP3 protocol - download-and-delete model"""
  POP3
}

"""
An email account configured for receiving emails via IMAP or POP3.
Each user can have multiple email accounts from different providers.
"""
type EmailAccount implements BaseEntityProps {
  """Unique identifier for this email account"""
  id: String!
  """Timestamp when the account was added"""
  createdAt: Date
  """Timestamp when the account was last modified"""
  updatedAt: Date
  """ID of the user who owns this account"""
  userId: String!
  """Display name for this account (e.g., "Work Gmail")"""
  name: String!
  """Email address for this account"""
  email: String!
  """IMAP/POP3 server hostname (e.g., "imap.gmail.com")"""
  host: String!
  """Server port number (e.g., 993 for IMAP with SSL)"""
  port: Int!
  """Protocol type (IMAP or POP3)"""
  accountType: EmailAccountType!
  """Whether to use SSL/TLS encryption"""
  useSsl: Boolean!
  """Timestamp of the last successful sync"""
  lastSyncedAt: Date
  """Whether a sync operation is currently in progress"""
  isSyncing: Boolean!
  """Progress percentage (0-100) during sync"""
  syncProgress: Int
  """Human-readable status message during sync"""
  syncStatus: String
  """When the current sync operation will timeout"""
  syncExpiresAt: Date
  """ID of the default SMTP profile for sending from this account"""
  defaultSmtpProfileId: String
  """The default SMTP profile object for sending emails"""
  defaultSmtpProfile: SmtpProfile
  """External provider ID (for OAuth-linked accounts like Google Workspace)"""
  providerId: String
  """Whether this is the user's default/primary email account"""
  isDefault: Boolean!
}

"""
Input for creating a new email account. Requires all connection details.
"""
input CreateEmailAccountInput {
  """Display name for the account"""
  name: String!
  """Email address"""
  email: String!
  """IMAP/POP3 server hostname"""
  host: String!
  """Server port number"""
  port: Int!
  """Username for authentication (often the email address)"""
  username: String!
  """Password or app-specific password for authentication"""
  password: String!
  """Protocol type (IMAP or POP3)"""
  accountType: EmailAccountType!
  """Whether to use SSL/TLS"""
  useSsl: Boolean!
  """ID of the default SMTP profile for sending"""
  defaultSmtpProfileId: String
  """External provider ID for OAuth-linked accounts"""
  providerId: String
  """Whether to set this as the default account"""
  isDefault: Boolean
}

"""
Input for updating an existing email account. Only provided fields will be updated.
"""
input UpdateEmailAccountInput {
  """ID of the email account to update"""
  id: String!
  """New display name"""
  name: String
  """New server hostname"""
  host: String
  """New server port"""
  port: Int
  """New username"""
  username: String
  """New password"""
  password: String
  """Whether to use SSL/TLS"""
  useSsl: Boolean
  """New default SMTP profile ID"""
  defaultSmtpProfileId: String
  """New provider ID"""
  providerId: String
  """Whether this should be the default account"""
  isDefault: Boolean
}

# ============ SMTP Profiles ============

"""
An SMTP profile for sending emails. Each email account can have a default SMTP profile,
or users can select a different profile when composing.
"""
type SmtpProfile implements BaseEntityProps {
  """Unique identifier for this SMTP profile"""
  id: String!
  """Timestamp when the profile was created"""
  createdAt: Date
  """Timestamp when the profile was last updated"""
  updatedAt: Date
  """ID of the user who owns this profile"""
  userId: String!
  """Display name for this profile (e.g., "Personal Gmail SMTP")"""
  name: String!
  """The "from" email address for sent emails"""
  email: String!
  """Optional display name alias (e.g., "John Doe" instead of just the email)"""
  alias: String
  """SMTP server hostname (e.g., "smtp.gmail.com")"""
  host: String!
  """SMTP server port (e.g., 587 for TLS, 465 for SSL)"""
  port: Int!
  """Whether to use SSL/TLS encryption"""
  useSsl: Boolean!
  """Whether this is the user's default SMTP profile"""
  isDefault: Boolean!
  """External provider ID for OAuth-linked profiles"""
  providerId: String
}

"""
Input for creating a new SMTP profile.
"""
input CreateSmtpProfileInput {
  """Display name for the profile"""
  name: String!
  """The "from" email address"""
  email: String!
  """Optional display name alias"""
  alias: String
  """SMTP server hostname"""
  host: String!
  """SMTP server port"""
  port: Int!
  """Username for SMTP authentication"""
  username: String!
  """Password for SMTP authentication"""
  password: String!
  """Whether to use SSL/TLS"""
  useSsl: Boolean!
  """Whether to set as default profile"""
  isDefault: Boolean
  """External provider ID"""
  providerId: String
}

"""
Input for updating an existing SMTP profile. Only provided fields will be updated.
"""
input UpdateSmtpProfileInput {
  """ID of the SMTP profile to update"""
  id: String!
  """New display name"""
  name: String
  """New display name alias"""
  alias: String
  """New server hostname"""
  host: String
  """New server port"""
  port: Int
  """New username"""
  username: String
  """New password"""
  password: String
  """Whether to use SSL/TLS"""
  useSsl: Boolean
  """Whether this should be the default profile"""
  isDefault: Boolean
  """New provider ID"""
  providerId: String
}

# ============ Contacts ============

"""
An email address associated with a contact. A contact can have multiple email addresses.
"""
type ContactEmail implements BaseEntityProps {
  """Unique identifier for this email entry"""
  id: String!
  """Timestamp when this email was added"""
  createdAt: Date
  """Timestamp when this email was last updated"""
  updatedAt: Date
  """ID of the contact this email belongs to"""
  contactId: String!
  """The email address"""
  email: String!
  """Whether this is the primary email for the contact"""
  isPrimary: Boolean!
  """Optional label (e.g., "Work", "Personal", "Other")"""
  label: String
}

"""
A contact in the user's address book. Contacts can be auto-created from
email senders or manually created.
"""
type Contact implements BaseEntityProps {
  """Unique identifier for this contact"""
  id: String!
  """Timestamp when the contact was created"""
  createdAt: Date
  """Timestamp when the contact was last updated"""
  updatedAt: Date
  """ID of the user who owns this contact"""
  userId: String!
  """Primary email address (deprecated - use emails array)"""
  email: String
  """List of all email addresses for this contact"""
  emails: [ContactEmail!]!
  """Full display name"""
  name: String
  """First name"""
  firstName: String
  """Last name"""
  lastName: String
  """Company or organization"""
  company: String
  """Phone number"""
  phone: String
  """Additional notes about the contact"""
  notes: String
  """Whether this contact was auto-created from an email sender"""
  isAutoCreated: Boolean!
}

"""
Input for a contact email when creating/updating contacts.
"""
input ContactEmailInput {
  """The email address"""
  email: String!
  """Whether this should be the primary email"""
  isPrimary: Boolean
  """Optional label for this email"""
  label: String
}

"""
Input for creating a new contact.
"""
input CreateContactInput {
  """List of email addresses for the contact"""
  emails: [ContactEmailInput!]!
  """Full display name"""
  name: String
  """First name"""
  firstName: String
  """Last name"""
  lastName: String
  """Company or organization"""
  company: String
  """Phone number"""
  phone: String
  """Additional notes"""
  notes: String
}

"""
Input for updating an existing contact. Only provided fields will be updated.
"""
input UpdateContactInput {
  """ID of the contact to update"""
  id: String!
  """Updated list of email addresses"""
  emails: [ContactEmailInput!]
  """Updated full name"""
  name: String
  """Updated first name"""
  firstName: String
  """Updated last name"""
  lastName: String
  """Updated company"""
  company: String
  """Updated phone"""
  phone: String
  """Updated notes"""
  notes: String
}

"""
Input for adding an email address to an existing contact.
"""
input AddEmailToContactInput {
  """ID of the contact to add the email to"""
  contactId: String!
  """The email address to add"""
  email: String!
  """Whether this should become the primary email"""
  isPrimary: Boolean
  """Optional label for this email"""
  label: String
}

# ============ Emails ============

"""
Email folder categories. Maps to standard IMAP folder semantics.
"""
enum EmailFolder {
  """Primary inbox for incoming emails"""
  INBOX
  """Emails sent by the user"""
  SENT
  """Unsent email drafts"""
  DRAFTS
  """Deleted emails (soft delete)"""
  TRASH
  """Emails marked as spam/junk"""
  SPAM
  """Archived emails (removed from inbox but kept)"""
  ARCHIVE
}

"""
Type of email attachment.
"""
enum AttachmentType {
  """Inline attachment (e.g., embedded images in HTML)"""
  INLINE
  """Regular file attachment"""
  ATTACHMENT
}

"""
A file attachment on an email.
"""
type Attachment implements BaseEntityProps {
  """Unique identifier for this attachment"""
  id: String!
  """Timestamp when the attachment was saved"""
  createdAt: Date
  """Timestamp when the attachment was last updated"""
  updatedAt: Date
  """ID of the email this attachment belongs to"""
  emailId: String!
  """Original filename of the attachment"""
  filename: String!
  """MIME type (e.g., "application/pdf", "image/png")"""
  mimeType: String!
  """File extension (e.g., "pdf", "png")"""
  extension: String
  """File size in bytes"""
  size: Int!
  """Storage key for retrieving the file (S3 key or local path)"""
  storageKey: String!
  """Whether this is an inline or regular attachment"""
  attachmentType: AttachmentType!
  """Content-ID for inline attachments (used in HTML src references)"""
  contentId: String
  """Content-Disposition header value"""
  contentDisposition: String
  """Whether the attachment has been scanned and deemed safe"""
  isSafe: Boolean!
}

"""
An email message. Can be received, sent, or a draft.
"""
type Email implements BaseEntityProps {
  """Unique identifier for this email"""
  id: String!
  """Timestamp when the email was stored locally"""
  createdAt: Date
  """Timestamp when the email was last modified locally"""
  updatedAt: Date
  """ID of the email account this email belongs to"""
  emailAccountId: String!
  """The email account object"""
  emailAccount: EmailAccount
  """ID of the SMTP profile used to send (for sent emails)"""
  smtpProfileId: String
  """The SMTP profile used to send this email"""
  smtpProfile: SmtpProfile
  """Unique message ID from the email headers (RFC 5322 Message-ID)"""
  messageId: String!
  """Which folder this email is in (INBOX, SENT, DRAFTS, etc.)"""
  folder: EmailFolder!
  """Sender's email address"""
  fromAddress: String!
  """Sender's display name"""
  fromName: String
  """List of "To" recipient email addresses"""
  toAddresses: [String!]!
  """List of "CC" recipient email addresses"""
  ccAddresses: [String!]
  """List of "BCC" recipient email addresses (only for sent emails)"""
  bccAddresses: [String!]
  """Email subject line"""
  subject: String!
  """Plain text body content"""
  textBody: String
  """HTML body content"""
  htmlBody: String
  """When the email was received (from email headers)"""
  receivedAt: Date!
  """Whether the email has been read"""
  isRead: Boolean!
  """Whether the email is starred/flagged"""
  isStarred: Boolean!
  """Whether this is an unsent draft"""
  isDraft: Boolean!
  """Message-ID of the email this is replying to"""
  inReplyTo: String
  """List of Message-IDs in the email thread"""
  references: [String!]
  """Thread identifier for grouping related emails"""
  threadId: String
  """Number of emails in this thread"""
  threadCount: Int
  """Raw email headers as JSON (for debugging)"""
  headers: JSON
  """Whether the user has unsubscribed from this sender"""
  isUnsubscribed: Boolean!
  """List-Unsubscribe URL if available"""
  unsubscribeUrl: String
  """List-Unsubscribe email address if available"""
  unsubscribeEmail: String
  """Tags/labels applied to this email"""
  tags: [Tag!]!
  """List of file attachments"""
  attachments: [Attachment!]!
  """Quick check if email has any attachments"""
  hasAttachments: Boolean!
  """Number of attachments"""
  attachmentCount: Int!
}

# ============ Tags ============

"""
A tag/label that can be applied to emails for organization.
Similar to Gmail labels or folder categories.
"""
type Tag implements BaseEntityProps {
  """Unique identifier for this tag"""
  id: String!
  """Timestamp when the tag was created"""
  createdAt: Date
  """Timestamp when the tag was last updated"""
  updatedAt: Date
  """ID of the user who owns this tag"""
  userId: String!
  """Display name for the tag"""
  name: String!
  """Color hex code for the tag (e.g., "#FF5733")"""
  color: String!
  """Optional description of what this tag is for"""
  description: String
  """Number of emails with this tag applied"""
  emailCount: Int!
}

"""
Input for creating a new tag.
"""
input CreateTagInput {
  """Display name for the tag"""
  name: String!
  """Color hex code (defaults to a random color if not provided)"""
  color: String
  """Optional description"""
  description: String
}

"""
Input for updating an existing tag. Only provided fields will be updated.
"""
input UpdateTagInput {
  """ID of the tag to update"""
  id: String!
  """New display name"""
  name: String
  """New color hex code"""
  color: String
  """New description"""
  description: String
}

"""
Input for adding multiple tags to multiple emails (bulk operation).
"""
input AddTagsToEmailsInput {
  """List of email IDs to add tags to"""
  emailIds: [String!]!
  """List of tag IDs to add"""
  tagIds: [String!]!
}

"""
Input for removing multiple tags from multiple emails (bulk operation).
"""
input RemoveTagsFromEmailsInput {
  """List of email IDs to remove tags from"""
  emailIds: [String!]!
  """List of tag IDs to remove"""
  tagIds: [String!]!
}

# ============ Mail Rules ============

"""
Conditions for matching emails in a mail rule.
All conditions are optional - only non-null conditions are evaluated.
Multiple conditions are combined with AND logic.
"""
type RuleConditions {
  """Match if sender address contains this substring (case-insensitive)"""
  fromContains: String
  """Match if any To address contains this substring"""
  toContains: String
  """Match if any CC address contains this substring"""
  ccContains: String
  """Match if any BCC address contains this substring"""
  bccContains: String
  """Match if subject contains this substring (case-insensitive)"""
  subjectContains: String
  """Match if body (text or HTML) contains this substring"""
  bodyContains: String
}

"""
Actions to perform when a mail rule matches an email.
Multiple actions can be combined.
"""
type RuleActions {
  """Move the email to Archive folder"""
  archive: Boolean
  """Star/flag the email"""
  star: Boolean
  """Move the email to Trash"""
  delete: Boolean
  """Mark the email as read"""
  markRead: Boolean
  """IDs of tags to add to the email"""
  addTagIds: [String!]
  """Email address to forward the message to"""
  forwardTo: String
}

"""
An automated mail rule that applies actions to matching emails.
Rules are processed in priority order when new emails arrive.
"""
type MailRule implements BaseEntityProps {
  """Unique identifier for this rule"""
  id: String!
  """Timestamp when the rule was created"""
  createdAt: Date
  """Timestamp when the rule was last updated"""
  updatedAt: Date
  """ID of the user who owns this rule"""
  userId: String!
  """Optional: Apply only to emails from this account (null = all accounts)"""
  emailAccountId: String
  """The email account this rule applies to"""
  emailAccount: EmailAccount
  """Display name for the rule"""
  name: String!
  """Optional description of what this rule does"""
  description: String
  """Conditions that emails must match"""
  conditions: RuleConditions!
  """Actions to perform on matching emails"""
  actions: RuleActions!
  """Whether this rule is currently active"""
  isEnabled: Boolean!
  """Processing priority (lower numbers run first)"""
  priority: Int!
  """If true, stop processing further rules after this one matches"""
  stopProcessing: Boolean!
}

"""
Input for rule conditions when creating/updating a rule.
"""
input RuleConditionsInput {
  """Match if sender address contains this substring"""
  fromContains: String
  """Match if any To address contains this substring"""
  toContains: String
  """Match if any CC address contains this substring"""
  ccContains: String
  """Match if any BCC address contains this substring"""
  bccContains: String
  """Match if subject contains this substring"""
  subjectContains: String
  """Match if body contains this substring"""
  bodyContains: String
}

"""
Input for rule actions when creating/updating a rule.
"""
input RuleActionsInput {
  """Move to Archive"""
  archive: Boolean
  """Star the email"""
  star: Boolean
  """Move to Trash"""
  delete: Boolean
  """Mark as read"""
  markRead: Boolean
  """Tag IDs to add"""
  addTagIds: [String!]
  """Email to forward to"""
  forwardTo: String
}

"""
Input for creating a new mail rule.
"""
input CreateMailRuleInput {
  """Optional: Restrict to a specific email account"""
  emailAccountId: String
  """Display name for the rule"""
  name: String!
  """Optional description"""
  description: String
  """Conditions for matching emails"""
  conditions: RuleConditionsInput!
  """Actions to perform on matches"""
  actions: RuleActionsInput!
  """Whether the rule is enabled (default: true)"""
  isEnabled: Boolean
  """Processing priority (default: 0)"""
  priority: Int
  """Stop processing after match (default: false)"""
  stopProcessing: Boolean
}

"""
Input for updating an existing mail rule. Only provided fields will be updated.
"""
input UpdateMailRuleInput {
  """ID of the rule to update"""
  id: String!
  """New email account restriction"""
  emailAccountId: String
  """New display name"""
  name: String
  """New description"""
  description: String
  """Updated conditions"""
  conditions: RuleConditionsInput
  """Updated actions"""
  actions: RuleActionsInput
  """Whether the rule is enabled"""
  isEnabled: Boolean
  """New priority"""
  priority: Int
  """Whether to stop processing after match"""
  stopProcessing: Boolean
}

"""
Result of running a mail rule against existing emails.
"""
type RunRuleResult {
  """Number of emails that matched the rule conditions"""
  matchedCount: Int!
  """Number of emails that were successfully processed"""
  processedCount: Int!
}

"""
Input for querying emails with filters.
"""
input GetEmailsInput {
  """Filter by email account ID (null = all accounts)"""
  emailAccountId: String
  """Filter by folder (null = depends on includeAllFolders)"""
  folder: EmailFolder
  """Maximum number of emails to return (default: 50)"""
  limit: Int
  """Number of emails to skip for pagination"""
  offset: Int
  """Filter by read status (null = all)"""
  isRead: Boolean
  """Filter by starred status (null = all)"""
  isStarred: Boolean
  """Full-text search query across subject and body"""
  searchQuery: String
  """If true, search across all folders; if false, defaults to INBOX"""
  includeAllFolders: Boolean
  """Advanced filter: sender contains"""
  fromContains: String
  """Advanced filter: To address contains"""
  toContains: String
  """Advanced filter: CC address contains"""
  ccContains: String
  """Advanced filter: BCC address contains"""
  bccContains: String
  """Advanced filter: subject contains"""
  subjectContains: String
  """Advanced filter: body contains"""
  bodyContains: String
  """Filter by applied tag IDs (emails must have ALL specified tags)"""
  tagIds: [String!]
}

"""
Input for fetching a single email by ID.
"""
input GetEmailInput {
  """ID of the email to fetch"""
  id: String!
}

"""
Input for an attachment when composing/sending an email.
Attachment data is provided as base64-encoded string.
"""
input AttachmentInput {
  """Filename for the attachment"""
  filename: String!
  """MIME type of the attachment"""
  mimeType: String!
  """File size in bytes (for validation)"""
  size: Int!
  """Base64-encoded file data"""
  data: String!
}

"""
Input for composing and sending an email.
"""
input ComposeEmailInput {
  """ID of the email account to send from"""
  emailAccountId: String!
  """ID of the SMTP profile to use for sending"""
  smtpProfileId: String!
  """List of To recipient email addresses"""
  toAddresses: [String!]!
  """Optional list of CC recipients"""
  ccAddresses: [String!]
  """Optional list of BCC recipients"""
  bccAddresses: [String!]
  """Email subject line"""
  subject: String!
  """Plain text body content"""
  textBody: String
  """HTML body content"""
  htmlBody: String
  """Message-ID of email being replied to (for threading)"""
  inReplyTo: String
  """ID of draft to convert to sent (draft will be deleted)"""
  draftId: String
  """List of file attachments to include"""
  attachments: [AttachmentInput!]
}

"""
Input for saving an email draft.
"""
input SaveDraftInput {
  """ID of existing draft to update (null = create new draft)"""
  id: String
  """Email account this draft belongs to"""
  emailAccountId: String!
  """SMTP profile for sending (optional for drafts)"""
  smtpProfileId: String
  """To recipient addresses"""
  toAddresses: [String!]
  """CC recipient addresses"""
  ccAddresses: [String!]
  """BCC recipient addresses"""
  bccAddresses: [String!]
  """Email subject"""
  subject: String
  """Plain text body"""
  textBody: String
  """HTML body"""
  htmlBody: String
  """Message-ID of email being replied to"""
  inReplyTo: String
  """Attachments for the draft"""
  attachments: [AttachmentInput!]
}

"""
Input for bulk updating multiple emails at once.
"""
input BulkUpdateEmailsInput {
  """IDs of emails to update"""
  ids: [String!]!
  """Set read status (null = don't change)"""
  isRead: Boolean
  """Set starred status (null = don't change)"""
  isStarred: Boolean
  """Move to folder (null = don't change)"""
  folder: EmailFolder
}

"""
Input for forwarding an email.
"""
input ForwardEmailInput {
  """ID of the email to forward"""
  emailId: String!
  """Email account to send from"""
  emailAccountId: String!
  """SMTP profile to use for sending"""
  smtpProfileId: String!
  """To recipient addresses"""
  toAddresses: [String!]!
  """Optional CC recipients"""
  ccAddresses: [String!]
  """Optional BCC recipients"""
  bccAddresses: [String!]
  """Optional text to add before forwarded content"""
  additionalText: String
  """Whether to include original attachments (default: true)"""
  includeAttachments: Boolean
}

"""
Input for triggering a sync of a specific email account.
"""
input SyncEmailAccountInput {
  """ID of the email account to sync"""
  emailAccountId: String!
}

"""
Input for unsubscribing from a sender's mailing list.
"""
input UnsubscribeInput {
  """ID of the email to unsubscribe from"""
  emailId: String!
}

# ============ Test Connection ============

"""
Result of testing an email account or SMTP connection.
"""
type TestConnectionResult {
  """Whether the connection was successful"""
  success: Boolean!
  """Human-readable message describing the result or error"""
  message: String!
}

"""
Input for testing an IMAP/POP3 connection before saving.
"""
input TestEmailAccountConnectionInput {
  """Server hostname"""
  host: String!
  """Server port"""
  port: Int!
  """Username for authentication"""
  username: String!
  """Password for authentication"""
  password: String!
  """Protocol type (IMAP or POP3)"""
  accountType: EmailAccountType!
  """Whether to use SSL/TLS"""
  useSsl: Boolean!
}

"""
Input for testing an SMTP connection before saving.
"""
input TestSmtpConnectionInput {
  """SMTP server hostname"""
  host: String!
  """SMTP server port"""
  port: Int!
  """Username for authentication"""
  username: String!
  """Password for authentication"""
  password: String!
  """Whether to use SSL/TLS"""
  useSsl: Boolean!
}

# ============ Email Sources (Triage) ============

"""
Aggregated information about a unique email sender.
Used for inbox triage and identifying frequent senders.
"""
type EmailSource {
  """Email address of the sender"""
  fromAddress: String!
  """Display name of the sender (if available)"""
  fromName: String
  """Number of emails received from this sender"""
  count: Int!
}

# ============ Queries ============

"""
GraphQL queries for fetching data. All queries require authentication
unless otherwise noted.
"""
type Query {
  # Auth
  """
  Fetch the current user's profile. Creates the user record if this is
  the first login after Supabase signup. Returns null if not authenticated.
  """
  fetchProfile: User

  """
  Get all authentication methods linked to the current user's account.
  Useful for managing connected OAuth providers.
  """
  getAuthenticationMethods: [AuthenticationMethod!]!

  # Email Accounts
  """
  Get all email accounts configured for the current user.
  Ordered by creation date, newest first.
  """
  getEmailAccounts: [EmailAccount!]!

  """
  Get a specific email account by ID.
  Returns null if not found or not owned by the current user.
  """
  getEmailAccount(
    """ID of the email account to fetch"""
    id: String!
  ): EmailAccount

  # SMTP Profiles
  """
  Get all SMTP profiles configured for the current user.
  Ordered by creation date, newest first.
  """
  getSmtpProfiles: [SmtpProfile!]!

  """
  Get a specific SMTP profile by ID.
  Returns null if not found or not owned by the current user.
  """
  getSmtpProfile(
    """ID of the SMTP profile to fetch"""
    id: String!
  ): SmtpProfile

  # Emails
  """
  Get emails matching the specified filters.
  Supports pagination, folder filtering, read/starred status, and full-text search.
  """
  getEmails(
    """Filter and pagination options"""
    input: GetEmailsInput!
  ): [Email!]!

  """
  Get a single email by ID.
  Returns null if not found or not accessible by the current user.
  """
  getEmail(
    """Email ID wrapped in input object"""
    input: GetEmailInput!
  ): Email

  """
  Get the count of emails matching the specified filters.
  Useful for pagination and unread counts.
  """
  getEmailCount(
    """Filter options (same as getEmails)"""
    input: GetEmailsInput!
  ): Int!

  """
  Get all emails in a specific thread.
  Returns emails ordered by receivedAt ascending.
  """
  getEmailsByThread(
    """Thread ID to fetch emails for"""
    threadId: String!
  ): [Email!]!

  """
  Get the top email senders for inbox triage.
  Aggregates senders by email count.
  """
  getTopEmailSources(
    """Maximum number of sources to return (default: 10)"""
    limit: Int
  ): [EmailSource!]!

  # Attachments
  """
  Get attachment metadata by ID.
  Returns null if not found or not accessible.
  """
  getAttachment(
    """ID of the attachment to fetch"""
    id: String!
  ): Attachment

  """
  Get a signed download URL for an attachment.
  In production, returns a presigned S3 URL (valid for 1 hour).
  In development, returns a local API endpoint.
  """
  getAttachmentDownloadUrl(
    """ID of the attachment"""
    id: String!
  ): String!

  # Contacts
  """
  Get all contacts for the current user.
  Includes both manually created and auto-created contacts.
  """
  getContacts: [Contact!]!

  """
  Get a specific contact by ID.
  Returns null if not found or not owned by the current user.
  """
  getContact(
    """ID of the contact to fetch"""
    id: String!
  ): Contact

  """
  Search contacts by name or email address.
  Performs case-insensitive partial matching.
  """
  searchContacts(
    """Search query string"""
    query: String!
  ): [Contact!]!

  # Tags
  """
  Get all tags for the current user.
  Includes email count for each tag.
  """
  getTags: [Tag!]!

  """
  Get a specific tag by ID.
  Returns null if not found or not owned by the current user.
  """
  getTag(
    """ID of the tag to fetch"""
    id: String!
  ): Tag

  # Mail Rules
  """
  Get all mail rules for the current user.
  Ordered by priority (lowest first).
  """
  getMailRules: [MailRule!]!

  """
  Get a specific mail rule by ID.
  Returns null if not found or not owned by the current user.
  """
  getMailRule(
    """ID of the mail rule to fetch"""
    id: String!
  ): MailRule

  """
  Preview how many existing emails would match a rule's conditions.
  Useful for testing rules before running them.
  """
  previewMailRule(
    """ID of the mail rule to preview"""
    id: String!
  ): Int!
}

# ============ Mutations ============

"""
GraphQL mutations for modifying data. All mutations require authentication.
"""
type Mutation {
  # Auth
  """
  Delete an authentication method (unlink OAuth provider).
  Cannot delete the last remaining auth method.
  """
  deleteAuthenticationMethod(
    """ID of the auth method to delete"""
    id: String!
  ): Boolean!

  """
  Update the user's theme preference (LIGHT, DARK, or AUTO).
  """
  updateThemePreference(
    """New theme preference"""
    themePreference: ThemePreference!
  ): User!

  """
  Update multiple user preferences at once.
  Only provided fields will be updated.
  """
  updateUserPreferences(
    """Preference updates"""
    input: UpdateUserPreferencesInput!
  ): User!

  # Email Accounts
  """
  Create a new email account (IMAP/POP3).
  Credentials are securely stored in AWS Secrets Manager (production)
  or a local file (development).
  """
  createEmailAccount(
    """Account details and credentials"""
    input: CreateEmailAccountInput!
  ): EmailAccount!

  """
  Update an existing email account.
  If password is provided, the stored credentials are also updated.
  """
  updateEmailAccount(
    """Fields to update"""
    input: UpdateEmailAccountInput!
  ): EmailAccount!

  """
  Delete an email account and all associated emails.
  This is a permanent, irreversible operation.
  """
  deleteEmailAccount(
    """ID of the account to delete"""
    id: String!
  ): Boolean!

  """
  Trigger a sync of an email account.
  Downloads new emails from the IMAP/POP3 server.
  """
  syncEmailAccount(
    """Account to sync"""
    input: SyncEmailAccountInput!
  ): Boolean!

  # SMTP Profiles
  """
  Create a new SMTP profile for sending emails.
  """
  createSmtpProfile(
    """Profile details and credentials"""
    input: CreateSmtpProfileInput!
  ): SmtpProfile!

  """
  Update an existing SMTP profile.
  """
  updateSmtpProfile(
    """Fields to update"""
    input: UpdateSmtpProfileInput!
  ): SmtpProfile!

  """
  Delete an SMTP profile.
  Cannot delete a profile that is set as default for an email account.
  """
  deleteSmtpProfile(
    """ID of the profile to delete"""
    id: String!
  ): Boolean!

  # Test Connections
  """
  Test an IMAP/POP3 connection before saving.
  Returns success/failure with an error message if applicable.
  """
  testEmailAccountConnection(
    """Connection details to test"""
    input: TestEmailAccountConnectionInput!
  ): TestConnectionResult!

  """
  Test an SMTP connection before saving.
  Returns success/failure with an error message if applicable.
  """
  testSmtpConnection(
    """Connection details to test"""
    input: TestSmtpConnectionInput!
  ): TestConnectionResult!

  # Emails
  """
  Send an email via SMTP.
  Stores a copy in the Sent folder and handles attachments.
  """
  sendEmail(
    """Email composition details"""
    input: ComposeEmailInput!
  ): Email!

  """
  Save an email draft.
  If id is provided, updates an existing draft; otherwise creates a new one.
  """
  saveDraft(
    """Draft content"""
    input: SaveDraftInput!
  ): Email!

  """
  Update multiple emails at once (read status, starred, folder).
  Returns the updated emails.
  """
  bulkUpdateEmails(
    """Update parameters"""
    input: BulkUpdateEmailsInput!
  ): [Email!]!

  """
  Permanently delete multiple emails.
  Returns the number of emails deleted.
  """
  bulkDeleteEmails(
    """IDs of emails to delete"""
    ids: [String!]!
  ): Int!

  """
  Forward an email to new recipients.
  Optionally includes original attachments.
  """
  forwardEmail(
    """Forward parameters"""
    input: ForwardEmailInput!
  ): Email!

  """
  Unsubscribe from a sender's mailing list.
  Uses List-Unsubscribe header if available.
  """
  unsubscribe(
    """Email to unsubscribe from"""
    input: UnsubscribeInput!
  ): Email!

  # Contacts
  """
  Create a new contact.
  """
  createContact(
    """Contact details"""
    input: CreateContactInput!
  ): Contact!

  """
  Update an existing contact.
  """
  updateContact(
    """Fields to update"""
    input: UpdateContactInput!
  ): Contact!

  """
  Delete a contact.
  """
  deleteContact(
    """ID of the contact to delete"""
    id: String!
  ): Boolean!

  """
  Create a contact from an email sender.
  Extracts name and email from the fromAddress/fromName fields.
  """
  createContactFromEmail(
    """ID of the email to create contact from"""
    emailId: String!
  ): Contact!

  """
  Add an email address to an existing contact.
  """
  addEmailToContact(
    """Email details to add"""
    input: AddEmailToContactInput!
  ): Contact!

  # Sync
  """
  Sync all email accounts for the current user.
  Triggers parallel sync for each account.
  """
  syncAllAccounts: Boolean!

  # Inbox Zero
  """
  Bulk delete old emails for inbox zero.
  Permanently deletes emails older than the specified date.
  """
  nukeOldEmails(
    """Filter for which emails to delete"""
    input: NukeOldEmailsInput!
  ): Int!

  # Tags
  """
  Create a new tag.
  """
  createTag(
    """Tag details"""
    input: CreateTagInput!
  ): Tag!

  """
  Update an existing tag.
  """
  updateTag(
    """Fields to update"""
    input: UpdateTagInput!
  ): Tag!

  """
  Delete a tag.
  Removes the tag from all emails but does not delete the emails.
  """
  deleteTag(
    """ID of the tag to delete"""
    id: String!
  ): Boolean!

  """
  Add tags to multiple emails (bulk operation).
  Returns the updated emails.
  """
  addTagsToEmails(
    """Emails and tags to add"""
    input: AddTagsToEmailsInput!
  ): [Email!]!

  """
  Remove tags from multiple emails (bulk operation).
  Returns the updated emails.
  """
  removeTagsFromEmails(
    """Emails and tags to remove"""
    input: RemoveTagsFromEmailsInput!
  ): [Email!]!

  # Mail Rules
  """
  Create a new mail rule.
  """
  createMailRule(
    """Rule details"""
    input: CreateMailRuleInput!
  ): MailRule!

  """
  Update an existing mail rule.
  """
  updateMailRule(
    """Fields to update"""
    input: UpdateMailRuleInput!
  ): MailRule!

  """
  Delete a mail rule.
  """
  deleteMailRule(
    """ID of the rule to delete"""
    id: String!
  ): Boolean!

  """
  Run a mail rule against existing emails.
  Applies the rule's actions to all matching emails.
  Returns counts of matched and processed emails.
  """
  runMailRule(
    """ID of the rule to run"""
    id: String!
  ): RunRuleResult!
}

"""
Input for bulk deleting old emails.
"""
input NukeOldEmailsInput {
  """Delete emails older than this date"""
  olderThan: Date
}

# ============ Subscriptions ============

"""
Real-time mailbox update event.
"""
type MailboxUpdate {
  """Type of update that occurred"""
  type: MailboxUpdateType!
  """ID of the email account that was updated"""
  emailAccountId: String!
  """New or updated emails (for NEW_EMAILS, EMAIL_UPDATED events)"""
  emails: [Email!]
  """Human-readable message describing the update"""
  message: String
}

"""
Types of mailbox update events.
"""
enum MailboxUpdateType {
  """New emails have arrived"""
  NEW_EMAILS
  """An existing email was updated (flags changed, etc.)"""
  EMAIL_UPDATED
  """An email was deleted from the server"""
  EMAIL_DELETED
  """Email sync has started"""
  SYNC_STARTED
  """Email sync has completed"""
  SYNC_COMPLETED
  """IMAP IDLE connection was established"""
  CONNECTION_ESTABLISHED
  """IMAP IDLE connection was closed (client should reconnect)"""
  CONNECTION_CLOSED
  """An error occurred"""
  ERROR
}

"""
GraphQL subscriptions for real-time updates.
Requires WebSocket connection with authentication.
"""
type Subscription {
  """
  Subscribe to mailbox updates for all of the user's email accounts.
  Uses IMAP IDLE to listen for new emails in real-time.
  
  Important: The connection will automatically close after approximately
  4.5 minutes due to IMAP IDLE timeout. Clients should reconnect when
  they receive a CONNECTION_CLOSED event.
  
  Events include:
  - NEW_EMAILS: New messages arrived
  - EMAIL_UPDATED: Email flags changed
  - SYNC_STARTED/COMPLETED: Sync operation status
  - CONNECTION_ESTABLISHED/CLOSED: Connection lifecycle
  - ERROR: Error occurred (check message field)
  """
  mailboxUpdates: MailboxUpdate!
}
